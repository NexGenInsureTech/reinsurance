<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facultative Placement Platform - POC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Corporate Zen -->
    <!-- Application Structure Plan: This POC is a task-oriented Single Page Application (SPA) designed for a reinsurance broker. The primary view is a "Dashboard" listing active placements. From here, the user can navigate to two other views: a "New Placement Form" and a "Placement Detail" view, which acts as the data room. This structure was chosen to directly mirror a broker's workflow: review portfolio, create new deal, manage deal. Navigation is handled by JavaScript, which shows/hides the relevant view containers, creating a seamless experience without page reloads. This design directly tests the core hypotheses of the 'Phase 1' strategy by simulating the proposed digital workflow. -->
    <!-- Visualization & Content Choices: The dashboard uses a clean table layout to present placements. The core visualization is in the "Placement Detail" view: a Chart.js Doughnut chart serves as a "Syndication Tracker," visually representing the percentage of the risk that has been quoted. This provides immediate, at-a-glance insight into placement progress, a key value proposition. Quotes are presented in a structured HTML table, and Q&A is handled in a simple, threaded-comment style layout. All data is mocked within JavaScript objects to simulate a live environment and demonstrate the platform's functionality without a backend. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .view { display: none; }
        .view.active { display: block; }
        .input-field { @apply w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500; }
        .btn { @apply font-semibold py-2 px-4 rounded-md transition-colors duration-200; }
        .btn-primary { @apply bg-indigo-600 text-white hover:bg-indigo-700; }
        .btn-secondary { @apply bg-gray-200 text-gray-800 hover:bg-gray-300; }
        .card { @apply bg-white rounded-lg shadow; }
        .tab { @apply px-4 py-2 font-medium text-gray-500 border-b-2 border-transparent hover:text-gray-700 hover:border-gray-300 cursor-pointer; }
        .tab.active { @apply text-indigo-600 border-indigo-500; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="text-gray-800">

    <div id="app-container" class="min-h-screen">
        <header class="bg-white shadow-sm sticky top-0 z-30">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <span class="text-2xl">üè¢</span>
                        <h1 class="text-xl font-bold text-gray-800">Facultative Placement Platform <span class="text-sm font-normal text-indigo-600">POC</span></h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-gray-500">Broker: Alex Carter</span>
                        <div class="w-10 h-10 bg-indigo-200 rounded-full flex items-center justify-center font-bold text-indigo-700">AC</div>
                    </div>
                </div>
            </div>
        </header>

        <main class="p-4 sm:p-6 lg:p-8">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view active">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">My Placements</h2>
                    <button id="btn-new-placement" class="btn btn-primary">Create New Placement</button>
                </div>
                <div class="card overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th class="p-4 font-semibold">Placement Name</th>
                                <th class="p-4 font-semibold">Cedent</th>
                                <th class="p-4 font-semibold">Limit Required</th>
                                <th class="p-4 font-semibold">Status</th>
                                <th class="p-4 font-semibold"></th>
                            </tr>
                        </thead>
                        <tbody id="placements-table-body">
                            <!-- JS will populate this -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- New Placement View -->
            <div id="new-placement-view" class="view">
                 <h2 class="text-2xl font-bold mb-6">Create New Facultative Placement</h2>
                 <div class="card p-6">
                    <div class="space-y-6">
                        <div>
                            <h3 class="font-semibold text-lg">1. Basic Details</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Placement Name</label>
                                    <input type="text" class="input-field" placeholder="e.g., Downtown Office Tower">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Ceding Company</label>
                                    <select class="input-field">
                                        <option>Regional Mutual Insurance</option>
                                        <option>National Property Insurers</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg">2. Risk & Coverage</h3>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Line of Business</label>
                                    <input type="text" class="input-field" value="Facultative Property" disabled>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Total Insured Value (USD)</label>
                                    <input type="number" class="input-field" placeholder="100000000">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Limit Required (USD)</label>
                                    <input type="number" class="input-field" placeholder="25000000">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Cedent Retention (USD)</label>
                                    <input type="number" class="input-field" placeholder="5000000">
                                </div>
                            </div>
                        </div>
                         <div class="flex justify-end space-x-4">
                            <button id="btn-cancel-new" class="btn btn-secondary">Cancel</button>
                            <button class="btn btn-primary">Save & View Placement</button>
                         </div>
                    </div>
                 </div>
            </div>

            <!-- Placement Detail View -->
            <div id="placement-detail-view" class="view">
                <div class="mb-6">
                    <button id="btn-back-to-dashboard" class="text-indigo-600 hover:underline font-medium">&larr; Back to Dashboard</button>
                    <h2 id="detail-placement-name" class="text-3xl font-bold mt-2"></h2>
                    <p id="detail-placement-cedent" class="text-gray-500"></p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="card">
                            <div class="border-b border-gray-200">
                                <nav id="detail-tabs" class="flex -mb-px px-6">
                                    <a class="tab active" data-tab="quotes">Quotes</a>
                                    <a class="tab" data-tab="qa">Q&A</a>
                                    <a class="tab" data-tab="details">Details</a>
                                </nav>
                            </div>
                            <div class="p-6">
                                <div id="tab-content-quotes" class="tab-content active">
                                    <table class="w-full text-left">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="p-3 font-semibold">Reinsurer</th>
                                                <th class="p-3 font-semibold">Line Offered (%)</th>
                                                <th class="p-3 font-semibold">Premium (USD)</th>
                                                <th class="p-3 font-semibold">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="quotes-body"></tbody>
                                    </table>
                                </div>
                                <div id="tab-content-qa" class="tab-content">
                                    <div class="space-y-4">
                                        <div id="qa-list" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                                            <!-- Q&A items will be injected here -->
                                        </div>
                                        <div class="mt-4">
                                            <textarea class="input-field" rows="3" placeholder="Ask a question to all participating reinsurers..."></textarea>
                                            <button class="btn btn-primary mt-2">Post Question</button>
                                        </div>
                                    </div>
                                </div>
                                <div id="tab-content-details" class="tab-content">
                                    <div id="risk-details-content" class="space-y-4"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <div class="card p-6">
                            <h3 class="font-bold text-lg mb-4">Syndication Progress</h3>
                            <div class="relative w-full h-64">
                                <canvas id="syndication-chart"></canvas>
                            </div>
                            <div class="mt-4 text-center">
                                <p class="text-gray-600">Limit Required: <span id="limit-required" class="font-bold"></span></p>
                                <p class="text-gray-600">Total Quoted: <span id="total-quoted" class="font-bold text-green-600"></span></p>
                            </div>
                        </div>
                        <div class="card p-6">
                            <h3 class="font-bold text-lg mb-4">Participating Reinsurers</h3>
                            <div id="reinsurers-list" class="space-y-2"></div>
                             <div class="mt-4">
                                <h4 class="font-semibold mb-2">Simulate Quote</h4>
                                <select id="quote-sim-reinsurer" class="input-field mb-2"></select>
                                <input id="quote-sim-line" type="number" class="input-field mb-2" placeholder="Line Offered (%)">
                                <button id="btn-simulate-quote" class="btn btn-secondary w-full">Submit Quote</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- DATA STORE (Mock Backend) ---
        const appData = {
            reinsurers: [
                { id: 1, name: 'Global Re' },
                { id: 2, name: 'Capital Solutions' },
                { id: 3, name: 'Apex Reinsurance' },
                { id: 4, name: 'Synergy Risk Partners' },
                { id: 5, name: 'Bermuda Mutual Re' },
            ],
            placements: [
                {
                    id: 1,
                    name: 'Downtown Office Tower',
                    cedent: 'Regional Mutual Insurance',
                    limitRequired: 25000000,
                    retention: 5000000,
                    tiv: 100000000,
                    status: 'In Progress',
                    participants: [1, 2, 3, 4, 5],
                    quotes: [
                        { reinsurerId: 1, line: 20, premium: 120000, status: 'Quoted' },
                        { reinsurerId: 2, line: 25, premium: 125000, status: 'Quoted' },
                        { reinsurerId: 4, line: 0, premium: 0, status: 'Declined' },
                    ],
                    qa: [
                        { from: 'Broker', text: 'Can you confirm the fire protection class for the location?' },
                        { from: 'Global Re', text: 'Our engineering team is reviewing. Stand by.' }
                    ]
                },
                {
                    id: 2,
                    name: 'Manufacturing Plant Portfolio',
                    cedent: 'National Property Insurers',
                    limitRequired: 50000000,
                    retention: 10000000,
                    tiv: 350000000,
                    status: 'In Progress',
                    participants: [1, 3, 5],
                    quotes: [],
                    qa: []
                },
                {
                    id: 3,
                    name: 'Coastal Hotel Chain',
                    cedent: 'Regional Mutual Insurance',
                    limitRequired: 15000000,
                    retention: 2500000,
                    tiv: 75000000,
                    status: 'Bound',
                    participants: [2, 4, 5],
                    quotes: [
                         { reinsurerId: 2, line: 50, premium: 250000, status: 'Bound' },
                         { reinsurerId: 5, line: 50, premium: 260000, status: 'Bound' },
                    ],
                    qa: []
                }
            ],
            currentPlacementId: null,
        };

        // --- UI ELEMENTS ---
        const views = {
            dashboard: document.getElementById('dashboard-view'),
            newPlacement: document.getElementById('new-placement-view'),
            placementDetail: document.getElementById('placement-detail-view'),
        };
        const placementsTableBody = document.getElementById('placements-table-body');
        const btnNewPlacement = document.getElementById('btn-new-placement');
        const btnCancelNew = document.getElementById('btn-cancel-new');
        const btnBackToDashboard = document.getElementById('btn-back-to-dashboard');
        
        // Detail View Elements
        const detailPlacementName = document.getElementById('detail-placement-name');
        const detailPlacementCedent = document.getElementById('detail-placement-cedent');
        const quotesBody = document.getElementById('quotes-body');
        const reinsurersList = document.getElementById('reinsurers-list');
        const detailTabs = document.getElementById('detail-tabs');
        const limitRequiredEl = document.getElementById('limit-required');
        const totalQuotedEl = document.getElementById('total-quoted');
        const riskDetailsContent = document.getElementById('risk-details-content');
        const qaList = document.getElementById('qa-list');
        const quoteSimReinsurerSelect = document.getElementById('quote-sim-reinsurer');
        const quoteSimLineInput = document.getElementById('quote-sim-line');
        const btnSimulateQuote = document.getElementById('btn-simulate-quote');
        
        let syndicationChart = null;

        // --- RENDER FUNCTIONS ---
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value);
        }
        
        function showView(viewName) {
            Object.values(views).forEach(view => view.classList.remove('active'));
            views[viewName].classList.add('active');
            window.scrollTo(0, 0);
        }

        function renderDashboard() {
            placementsTableBody.innerHTML = '';
            appData.placements.forEach(p => {
                const totalQuotedLine = p.quotes.filter(q => q.status.includes('Quoted') || q.status.includes('Bound')).reduce((sum, q) => sum + q.line, 0);
                const statusColor = p.status === 'Bound' ? 'bg-green-100 text-green-800' : (totalQuotedLine >= 100 ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800');
                const finalStatus = p.status === 'Bound' ? 'Bound' : (totalQuotedLine >= 100 ? 'Fully Quoted' : 'In Progress');

                const row = `
                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                        <td class="p-4 font-medium">${p.name}</td>
                        <td class="p-4 text-gray-600">${p.cedent}</td>
                        <td class="p-4 text-gray-600">${formatCurrency(p.limitRequired)}</td>
                        <td class="p-4"><span class="px-2 py-1 text-xs font-medium rounded-full ${statusColor}">${finalStatus}</span></td>
                        <td class="p-4 text-right"><button class="btn-view-placement text-indigo-600 hover:underline" data-id="${p.id}">View</button></td>
                    </tr>
                `;
                placementsTableBody.innerHTML += row;
            });
            document.querySelectorAll('.btn-view-placement').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.dataset.id);
                    renderPlacementDetail(id);
                });
            });
        }

        function renderPlacementDetail(placementId) {
            appData.currentPlacementId = placementId;
            const p = appData.placements.find(p => p.id === placementId);
            if (!p) return;

            detailPlacementName.textContent = p.name;
            detailPlacementCedent.textContent = p.cedent;
            
            // Render Quotes
            quotesBody.innerHTML = '';
            p.quotes.forEach(q => {
                const reinsurer = appData.reinsurers.find(r => r.id === q.reinsurerId);
                const statusColor = q.status === 'Bound' ? 'text-green-600' : (q.status === 'Quoted' ? 'text-blue-600' : 'text-red-600');
                const row = `
                    <tr class="border-b border-gray-200">
                        <td class="p-3 font-medium">${reinsurer.name}</td>
                        <td class="p-3">${q.line > 0 ? q.line + '%' : '-'}</td>
                        <td class="p-3">${q.premium > 0 ? formatCurrency(q.premium) : '-'}</td>
                        <td class="p-3 font-semibold ${statusColor}">${q.status}</td>
                    </tr>
                `;
                quotesBody.innerHTML += row;
            });
            if (p.quotes.length === 0) {
                quotesBody.innerHTML = `<tr><td colspan="4" class="p-4 text-center text-gray-500">No quotes submitted yet.</td></tr>`;
            }

            // Render Participants
            reinsurersList.innerHTML = '';
            p.participants.forEach(id => {
                const reinsurer = appData.reinsurers.find(r => r.id === id);
                reinsurersList.innerHTML += `<div class="flex justify-between items-center text-sm p-2 bg-gray-50 rounded-md"><span>${reinsurer.name}</span><span class="text-green-500">‚úî Invited</span></div>`;
            });
            
            // Render Risk Details
            riskDetailsContent.innerHTML = `
                <p><strong>Total Insured Value (TIV):</strong> ${formatCurrency(p.tiv)}</p>
                <p><strong>Cedent Retention:</strong> ${formatCurrency(p.retention)}</p>
                <p><strong>Limit Required:</strong> ${formatCurrency(p.limitRequired)}</p>
            `;

            // Render Q&A
            qaList.innerHTML = '';
            p.qa.forEach(item => {
                const align = item.from === 'Broker' ? 'items-end' : 'items-start';
                const bgColor = item.from === 'Broker' ? 'bg-indigo-500 text-white' : 'bg-gray-200 text-gray-800';
                qaList.innerHTML += `
                    <div class="flex flex-col ${align}">
                        <div class="font-bold text-sm mb-1">${item.from}</div>
                        <div class="p-3 rounded-lg ${bgColor} max-w-lg">${item.text}</div>
                    </div>
                `;
            });

            // Update Syndication Chart
            const totalQuotedLine = p.quotes.filter(q => q.status.includes('Quoted') || q.status.includes('Bound')).reduce((sum, q) => sum + q.line, 0);
            const remaining = Math.max(0, 100 - totalQuotedLine);
            
            limitRequiredEl.textContent = formatCurrency(p.limitRequired);
            totalQuotedEl.textContent = formatCurrency(p.limitRequired * (totalQuotedLine / 100));

            if (syndicationChart) {
                syndicationChart.destroy();
            }
            syndicationChart = new Chart(document.getElementById('syndication-chart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Quoted', 'Remaining'],
                    datasets: [{
                        data: [totalQuotedLine, remaining],
                        backgroundColor: ['#4f46e5', '#e5e7eb'],
                        borderColor: '#fff',
                        borderWidth: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false },
                    }
                }
            });
            
            // Populate quote simulator
            quoteSimReinsurerSelect.innerHTML = '';
            const unquotedReinsurers = appData.reinsurers.filter(r => 
                p.participants.includes(r.id) && !p.quotes.some(q => q.reinsurerId === r.id)
            );
            unquotedReinsurers.forEach(r => {
                quoteSimReinsurerSelect.innerHTML += `<option value="${r.id}">${r.name}</option>`;
            });

            showView('placementDetail');
        }

        // --- EVENT LISTENERS ---
        btnNewPlacement.addEventListener('click', () => showView('newPlacement'));
        btnCancelNew.addEventListener('click', () => showView('dashboard'));
        btnBackToDashboard.addEventListener('click', () => showView('dashboard'));

        detailTabs.addEventListener('click', (e) => {
            if (e.target.classList.contains('tab')) {
                const tabName = e.target.dataset.tab;
                detailTabs.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                
                document.querySelectorAll('#placement-detail-view .tab-content').forEach(c => c.classList.remove('active'));
                document.getElementById(`tab-content-${tabName}`).classList.add('active');
            }
        });
        
        btnSimulateQuote.addEventListener('click', () => {
            const reinsurerId = parseInt(quoteSimReinsurerSelect.value);
            const line = parseInt(quoteSimLineInput.value);
            
            if (!reinsurerId || !line || line <= 0) {
                alert('Please select a reinsurer and enter a valid line percentage.');
                return;
            }

            const placement = appData.placements.find(p => p.id === appData.currentPlacementId);
            if (placement) {
                placement.quotes.push({
                    reinsurerId: reinsurerId,
                    line: line,
                    premium: placement.limitRequired * (line / 100) * 0.05, // Mock premium calculation
                    status: 'Quoted'
                });
                quoteSimLineInput.value = '';
                renderPlacementDetail(appData.currentPlacementId); // Re-render the view
            }
        });

        // --- INITIALIZATION ---
        renderDashboard();
    });
    </script>
</body>
</html>
